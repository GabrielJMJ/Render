/**
 * GabrielJMJ\Render
 *
 * @license MIT License
 * @author Gabriel Jacinto aka. GabrielJMJ <gamjj74@hotmail.com>
*/

var VarsCollection=function(){this.vars=[];}VarsCollection.prototype.setVar=function(a,b){this.vars[a]=b;}VarsCollection.prototype.hasVar=function(a){for(var b in this.vars){if(b==a){return true;}}return false;}VarsCollection.prototype.getVars=function(){return this.vars;}VarsCollection.prototype.getVar=function(a){return this.vars[a];}var Element=function(a){this.id=a;}Element.prototype=new VarsCollection();Element.prototype.getId=function(){return this.id;}var Parser=function(){}Parser.prototype.getVarsFromContent=function(a){var b=/\${([a-zA-Z0-9._\.]+)}/g;var c=[];while((vars=b.exec(a))!=null){c.push(vars[1]);}return c;}var ElementParser=function(a){this.element=a;}ElementParser.prototype=new Parser();ElementParser.prototype.getLists=function(){var a=/\$foreach\(([a-zA-Z0-9. ]+)\)\{\s.*\s+\}/g;var b=/\$foreach\(.*\)\{(\s+.*\s+)\}/g;var c=/(\$foreach\(.*\)\{\s.*\s+\})/g;var d=document.getElementById(this.element.getId()).innerHTML;var e=[];while((names=c.exec(d))!==null){var f=names[1];var g=a.exec(f);g=g[1];var h=g.split(' as ');g=h[0];h=h[h.length-1];var i=b.exec(f);i=i[1];var j={array:g,var:h,content:i,complete:f};e.push(j);}return e;}ElementParser.prototype.getVars=function(){return this.getVarsFromContent(document.getElementById(this.element.getId()).innerHTML);}var Render=function(){this.elements=[];this.globalVars=new VarsCollection();}Render.prototype.element=function(a){this.elements.push(new Element(a));this.currentElement=a;this.currentGlobal=false;return this;}Render.prototype.global=function(){this.currentGlobal=true;return this;}Render.prototype.setVar=function(a,b){if(this.currentGlobal){this.globalVars.setVar(a,b);}else{for(var c in this.elements){if(this.elements[c].getId()===this.currentElement){this.elements[c].setVar(a,b);this.elements[c]=this.elements[c];}}}return this;}Render.prototype.getVar=function(a,b){for(var c in this.elements){if(this.elements[c].getId()===a){return this.elements[c].getVar(b);}}}Render.prototype.setFromCodeParts=function(a){var b=new Parser();var c=a.innerHTML;var d=b.getVarsFromContent(c);for(var e in d){if(this.globalVars.hasVar(d[e])){c=c.replace('${'+d[e]+'}',this.globalVars.getVar(d[e]));}}a.innerHTML=c;}Render.prototype.render=function(){var a=[];for(var b in this.elements){var c=this.elements[b];var d=new ElementParser(c);var e=c.getVars();var f=d.getLists(c.getId());var g=document.getElementById(c.getId());var h=g.innerHTML;var i=[];for(var j in f){h=this.getListContent(f[j]);}var k=d.getVarsFromContent(h);for(var l in k){if(c.hasVar(k[l])){h=h.replace('${'+k[l]+'}',c.getVar(k[l]));}else if(this.globalVars.hasVar(k[l])){h=h.replace('${'+k[l]+'}',this.globalVars.getVar(k[l]));}}g.innerHTML=h;this.getListContent=function(m){var n=d.getVarsFromContent(m.content);var o=[];var p=[];var q=0;for(var r in e){if(m.array===r){var s=this.getVar(c.getId(),m.array);var t=m.content;var u=m.var;var v=[];for(var q=0,length=n.length;q<length;q++){if(n[q].split('.')[0]==u){for(var w=0,lLength=s.length;w<lLength;w++){var x=n[q].split('.');x[0]='listArr[n]';if(typeof v[w]!=='undefined'){v[w]=v[w].replace('${'+n[q]+'}',eval(x.join('.')));}else{v[w]=t.replace('${'+n[q]+'}',eval(x.join('.')));}}}}}}return h.replace(m.complete,v.join(''));}}this.setFromCodeParts(document.body);this.setFromCodeParts(document.head);}render=new Render();