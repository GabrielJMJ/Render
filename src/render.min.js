/**
 * GabrielJMJ\Render
 *
 * @license MIT License
 * @author Gabriel Jacinto aka. GabrielJMJ <gamjj74@hotmail.com>
*/

var VarsCollection=function(){this.vars=[]};VarsCollection.prototype.setVar=function(e,t){this.vars[e]=t},VarsCollection.prototype.hasVar=function(e){for(var t in this.vars)if(t==e)return!0;return!1},VarsCollection.prototype.getVars=function(){return this.vars},VarsCollection.prototype.getVar=function(e){return this.vars[e]};var Element=function(e){this.id=e};Element.prototype=new VarsCollection,Element.prototype.getId=function(){return this.id};var Parser=function(){};Parser.prototype.getVarsFromContent=function(e){for(var t=/\${([a-zA-Z0-9._\.]+)}/g,r=[];null!=(vars=t.exec(e));)r.push(vars[1]);return r},Parser.prototype.getListsFromContent=function(e){for(var t=/\$foreach\(([a-zA-Z0-9. ]+)\)\{\s.*\s+\}/g,r=/\$foreach\(.*\)\{(\s+.*\s+)\}/g,n=/(\$foreach\(.*\)\{\s.*\s+\})/g,o=[];null!==(names=n.exec(e));){var s=names[1],a=t.exec(s);a=a[1];var i=a.split(" as ");a=i[0],i=i[i.length-1];var l=r.exec(s);l=l[1];var c={array:a,"var":i,content:l,complete:s};o.push(c)}return o};var ElementParser=function(e){this.element=e};ElementParser.prototype=new Parser,ElementParser.prototype.getLists=function(){return this.getListsFromContent(document.getElementById(this.element.getId()).innerHTML)},ElementParser.prototype.getVars=function(){return this.getVarsFromContent(document.getElementById(this.element.getId()).innerHTML)};var Render=function(){this.elements=[],this.globalVars=new VarsCollection};Render.prototype.element=function(e){return this.elements.push(new Element(e)),this.currentElement=e,this.currentGlobal=!1,this},Render.prototype.global=function(){return this.currentGlobal=!0,this},Render.prototype.setVar=function(e,t){if(this.currentGlobal)this.globalVars.setVar(e,t);else for(var r in this.elements)this.elements[r].getId()===this.currentElement&&(this.elements[r].setVar(e,t),this.elements[r]=this.elements[r]);return this},Render.prototype.getVar=function(e,t){for(var r in this.elements)if(this.elements[r].getId()===e)return this.elements[r].getVar(t)},Render.prototype.setFromCodeParts=function(e,t){var r=t.innerHTML,n=e.getVarsFromContent(r),o=e.getListsFromContent(r);for(list in o)r=this.getListContent(o[list]);t.innerHTML=r;for(var s in n)this.globalVars.hasVar(n[s])&&(r=r.replace("${"+n[s]+"}",this.globalVars.getVar(n[s])));t.innerHTML=r},Render.prototype.getListContent=function(e,t,r,n){var o=e.getVarsFromContent(t.content);for(var s in r.getVars())if(t.array===s)for(var a=this.getVar(r.getId(),t.array),i=t.content,l=t["var"],c=[],h=0,p=o.length;p>h;h++)if(o[h].split(".")[0]==l)for(var u=0,m=a.length;m>u;u++){var f=o[h].split(".");f.splice(0,1);var g=a[u];for(var v in f)g=g[f[v]];c[u]="undefined"!=typeof c[u]?c[u].replace("${"+o[h]+"}",g):i.replace("${"+o[h]+"}",g)}return n.replace(t.complete,c.join(""))},Render.prototype.render=function(){for(var e in this.elements){var t=this.elements[e],r=new ElementParser(t),n=r.getLists(t.getId()),o=document.getElementById(t.getId()),s=o.innerHTML;for(var a in n)s=this.getListContent(r,n[a],t,s);var i=r.getVarsFromContent(s);for(var l in i){var c=i[l].split("."),h=c[0];c.splice(0,1);var p=t.getVar(h);if(t.hasVar(h)){if(c.length&&"object"==typeof t.getVar(h))for(var u in c)p=p[c[u]];s=s.replace("${"+i[l]+"}",p)}}o.innerHTML=s}var m=new Parser;this.setFromCodeParts(m,document.body),this.setFromCodeParts(m,document.head)},Render=new Render;