var Element=function(e){this.id=e,this.vars=[]};Element.prototype.setVar=function(e,t){if(this.vars.length){var n=!1;for(var r in this.vars)this.vars[r].name===e&&(this.vars[r].value=t,n=!0);n||this.vars.push({name:e,value:t})}else this.vars.push({name:e,value:t})},Element.prototype.getId=function(){return this.id},Element.prototype.getVars=function(){return this.vars},Element.prototype.getVar=function(e){for(var t in this.vars)if(this.vars[t].name===e)return this.vars[t].value};var Parser=function(){};Parser.prototype.getVarsFromContent=function(e){for(var t=/\${([a-zA-Z0-9._\.]+)}/g,n=[];null!=(vars=t.exec(e));)n.push(vars[1]);return n};var ElementParser=function(e){this.element=e};ElementParser.prototype=new Parser,ElementParser.prototype.getLists=function(){for(var e=/\$foreach\(([a-zA-Z0-9. ]+)\)\{\s.*\s+\}/g,t=/\$foreach\(.*\)\{(\s+.*\s+)\}/g,n=/(\$foreach\(.*\)\{\s.*\s+\})/g,r=document.getElementById(this.element.getId()).innerHTML,s=[];null!==(names=n.exec(r));){var a=names[1],i=e.exec(a);i=i[1];var o=i.split(" as ");i=o[0],o=o[o.length-1];var l=t.exec(a);l=l[1];var c={array:i,"var":o,content:l,complete:a};s.push(c)}return s},ElementParser.prototype.getVars=function(){return this.getVarsFromContent(document.getElementById(this.element.getId()).innerHTML)};var Render=function(){this.elements=[]};Render.prototype.element=function(e){return this.elements.push(new Element(e)),this.currentElement=e,this},Render.prototype.setVar=function(e,t){for(var n in this.elements)this.elements[n].getId()===this.currentElement&&(this.elements[n].setVar(e,t),this.elements[n]=this.elements[n]);return this},Render.prototype.getVar=function(e,t){for(var n in this.elements)if(this.elements[n].getId()===e)return this.elements[n].getVar(t)},Render.prototype.render=function(){for(var k in this.elements){var element=this.elements[k],parser=new ElementParser(element),elementV=element.getVars(),lists=parser.getLists(element.getId()),el=document.getElementById(element.getId()),content=el.innerHTML,elVars=element.getVars(),contentList=[];for(var l in lists){var contentVars=parser.getVarsFromContent(lists[l].content),toReplace=[],toPut=[],i=0;for(var y in elementV)if(lists[l].array===elementV[y].name)for(var listArr=this.getVar(element.getId(),lists[l].array),cContent=lists[l].content,currentVar=lists[l]["var"],currentContent=[],i=0;i<contentVars.length;i++)if(contentVars[i].split(".")[0]==currentVar)for(var n=0;n<listArr.length;n++){var realObj=contentVars[i].split(".");realObj[0]="listArr[n]",currentContent[n]="undefined"!=typeof currentContent[n]?currentContent[n].replace("${"+contentVars[i]+"}",eval(realObj.join("."))):cContent.replace("${"+contentVars[i]+"}",eval(realObj.join(".")))}content=content.replace(lists[l].complete,currentContent.join(""))}var vars=parser.getVarsFromContent(content);for(var z in elVars)for(var y in vars)vars[y]===elVars[z].name&&(content=content.replace("${"+vars[y]+"}",elVars[z].value));el.innerHTML=content}},render=new Render;