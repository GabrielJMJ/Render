/**
 * GabrielJMJ\Render
 *
 * @license MIT License
 * @author Gabriel Jacinto aka. GabrielJMJ <gamjj74@hotmail.com>
*/

var VarsCollection=function(){this.vars=[]};VarsCollection.prototype.setVar=function(e,t){this.vars[e]=t},VarsCollection.prototype.hasVar=function(e){for(var t in this.vars)if(t==e)return!0;return!1},VarsCollection.prototype.getVars=function(){return this.vars},VarsCollection.prototype.getVar=function(e){return this.vars[e]};var Element=function(e){this.id=e};Element.prototype=new VarsCollection,Element.prototype.getId=function(){return this.id};var Parser=function(){};Parser.prototype.getVarsFromContent=function(e){for(var t=/\${([a-zA-Z0-9._\.]+)}/g,r=[];null!=(vars=t.exec(e));)r.push(vars[1]);return r};var ElementParser=function(e){this.element=e};ElementParser.prototype=new Parser,ElementParser.prototype.getLists=function(){for(var e=/\$foreach\(([a-zA-Z0-9. ]+)\)\{\s.*\s+\}/g,t=/\$foreach\(.*\)\{(\s+.*\s+)\}/g,r=/(\$foreach\(.*\)\{\s.*\s+\})/g,n=document.getElementById(this.element.getId()).innerHTML,o=[];null!==(names=r.exec(n));){var s=names[1],a=e.exec(s);a=a[1];var l=a.split(" as ");a=l[0],l=l[l.length-1];var i=t.exec(s);i=i[1];var c={array:a,"var":l,content:i,complete:s};o.push(c)}return o},ElementParser.prototype.getVars=function(){return this.getVarsFromContent(document.getElementById(this.element.getId()).innerHTML)};var Render=function(){this.elements=[],this.globalVars=new VarsCollection};Render.prototype.element=function(e){return this.elements.push(new Element(e)),this.currentElement=e,this.currentGlobal=!1,this},Render.prototype.global=function(){return this.currentGlobal=!0,this},Render.prototype.setVar=function(e,t){if(this.currentGlobal)this.globalVars.setVar(e,t);else for(var r in this.elements)this.elements[r].getId()===this.currentElement&&(this.elements[r].setVar(e,t),this.elements[r]=this.elements[r]);return this},Render.prototype.getVar=function(e,t){for(var r in this.elements)if(this.elements[r].getId()===e)return this.elements[r].getVar(t)},Render.prototype.render=function(){var htmls=[];for(var k in this.elements){var element=this.elements[k],parser=new ElementParser(element),elementV=element.getVars(),lists=parser.getLists(element.getId()),el=document.getElementById(element.getId()),content=el.innerHTML,contentList=[];for(var l in lists)content=this.getListContent(lists[l]);var vars=parser.getVarsFromContent(content);for(var y in vars)element.hasVar(vars[y])?content=content.replace("${"+vars[y]+"}",element.getVar(vars[y])):this.globalVars.hasVar(vars[y])&&(content=content.replace("${"+vars[y]+"}",this.globalVars.getVar(vars[y])));el.innerHTML=content,this.getListContent=function(list){var contentVars=parser.getVarsFromContent(list.content),toReplace=[],toPut=[],i=0;for(var y in elementV)if(list.array===y)for(var listArr=this.getVar(element.getId(),list.array),cContent=list.content,currentVar=list["var"],currentContent=[],i=0,length=contentVars.length;length>i;i++)if(contentVars[i].split(".")[0]==currentVar)for(var n=0,lLength=listArr.length;lLength>n;n++){var realObj=contentVars[i].split(".");realObj[0]="listArr[n]",currentContent[n]="undefined"!=typeof currentContent[n]?currentContent[n].replace("${"+contentVars[i]+"}",eval(realObj.join("."))):cContent.replace("${"+contentVars[i]+"}",eval(realObj.join(".")))}return content.replace(list.complete,currentContent.join(""))}}var parser=new Parser,body=document.body,bodyContent=body.innerHTML,varsFromBody=parser.getVarsFromContent(bodyContent);for(var v in varsFromBody)this.globalVars.hasVar(varsFromBody[v])&&(bodyContent=bodyContent.replace("${"+varsFromBody[v]+"}",this.globalVars.getVar(varsFromBody[v])));body.innerHTML=bodyContent},render=new Render;