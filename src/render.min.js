var Element=function(e){this.id=e,this.vars=[]};Element.prototype.setVar=function(e,t){if(this.vars.length){var r=!1;for(var n in this.vars)this.vars[n].name===e&&(this.vars[n].value=t,r=!0);r||this.vars.push({name:e,value:t})}else this.vars.push({name:e,value:t})},Element.prototype.getId=function(){return this.id},Element.prototype.getVars=function(){return this.vars},Element.prototype.getVar=function(e){for(var t in this.vars)if(this.vars[t].name===e)return this.vars[t].value};var Parser=function(){};Parser.prototype.getVarsFromContent=function(e){for(var t=/\${([a-zA-Z0-9._\.]+)}/g,r=[];null!=(vars=t.exec(e));)r.push(vars[1]);return r};var ElementParser=function(e){this.element=e};ElementParser.prototype=new Parser,ElementParser.prototype.getLists=function(){for(var e=/\$foreach\(([a-zA-Z0-9. ]+)\)\{\s.*\s+\}/g,t=/\$foreach\(.*\)\{(\s+.*\s+)\}/g,r=/(\$foreach\(.*\)\{\s.*\s+\})/g,n=document.getElementById(this.element.getId()).innerHTML,s=[];null!==(names=r.exec(n));){var a=names[1],i=e.exec(a);i=i[1];var l=i.split(" as ");i=l[0],l=l[l.length-1];var o=t.exec(a);o=o[1];var m={array:i,"var":l,content:o,complete:a};s.push(m)}return s},ElementParser.prototype.getVars=function(){return this.getVarsFromContent(document.getElementById(this.element.getId()).innerHTML)};var Render=function(){this.elements=[]};Render.prototype.element=function(e){return this.elements.push(new Element(e)),this.currentElement=e,this},Render.prototype.setVar=function(e,t){for(var r in this.elements)this.elements[r].getId()===this.currentElement&&(this.elements[r].setVar(e,t),this.elements[r]=this.elements[r]);return this},Render.prototype.getVar=function(e,t){for(var r in this.elements)if(this.elements[r].getId()===e)return this.elements[r].getVar(t)},Render.prototype.render=function(){for(var k in this.elements){var element=this.elements[k],parser=new ElementParser(element),vars=parser.getVars(element.getId()),elementV=element.getVars(),lists=parser.getLists(element.getId()),el=document.getElementById(element.getId()),content=el.innerHTML,elVars=element.getVars(),contentList=[];for(var l in lists){var contentVars=parser.getVarsFromContent(lists[l].content);for(var y in elementV)if(lists[l].array===elementV[y].name)for(var v in contentVars){var objVarSplit=contentVars[v].split(".");if(objVar=objVarSplit[0],objVar===lists[l]["var"]){var listArr=this.getVar(element.getId(),lists[l].array);originalObj=objVarSplit.join(".");for(var lv in listArr){var newObjVar=objVarSplit;newObjVar[0]="listArr[lv]";var obj=newObjVar.join(".");contentList.push(lists[l].content.replace("${"+originalObj+"}",eval(obj)))}}}content=content.replace(lists[l].complete,contentList.join(""))}for(var z in elVars)for(var y in vars)vars[y]===elVars[z].name&&(content=content.replace("${"+vars[y]+"}",elVars[z].value));el.innerHTML=content}},render=new Render;