/**
 * GabrielJMJ\Render
 *
 * @license MIT License
 * @author Gabriel Jacinto aka. GabrielJMJ <gamjj74@hotmail.com>
*/

var VarsCollection=function(){this.vars=[]};VarsCollection.prototype.setVar=function(e,t){this.vars[e]=t},VarsCollection.prototype.hasVar=function(e){for(var t in this.vars)if(t==e)return!0;return!1},VarsCollection.prototype.getVars=function(){return this.vars},VarsCollection.prototype.getVar=function(e){return this.vars[e]};var RenderElement=function(e){this.id=e};RenderElement.prototype=new VarsCollection,RenderElement.prototype.getId=function(){return this.id};var Parser=function(){};Parser.prototype.getVarsFromContent=function(e){for(var t=/\${([a-zA-Z0-9._\.]+)}/g,r=[];null!==(vars=t.exec(e));)r.push(vars[1]);return r},Parser.prototype.getListsFromContent=function(e){for(var t=/\$foreach\(([a-zA-Z0-9. ]+)\)\{\s.*\s+\}/g,r=/\$foreach\(.*\)\{(\s+.*\s+)\}/g,n=/(\$foreach\(.*\)\{\s.*\s+\})/g,o=[];null!==(names=n.exec(e));){var s=names[1],i=t.exec(s);i=i[1];var a=i.split(" as ");i=a[0],a=a[a.length-1];var l=r.exec(s);l=l[1];var f={array:i,"var":a,content:l,complete:s};o.push(f)}return o};var ElementParser=function(e){this.element=e};ElementParser.prototype=new Parser,ElementParser.prototype.getLists=function(){return this.getListsFromContent(document.getElementById(this.element.getId()).innerHTML)},ElementParser.prototype.getVars=function(){return this.getVarsFromContent(document.getElementById(this.element.getId()).innerHTML)};var Render=function(){this.elements=[],this.globalVars=new VarsCollection};Render.prototype.element=function(e){return this.elements.push(new RenderElement(e)),this.currentElement=e,this.currentGlobal=!1,this},Render.prototype.global=function(){return this.currentGlobal=!0,this},Render.prototype.setVar=function(e,t){if(this.currentGlobal)this.globalVars.setVar(e,t);else for(var r in this.elements)this.elements[r].getId()===this.currentElement&&(this.elements[r].setVar(e,t),this.elements[r]=this.elements[r]);return this},Render.prototype.getVar=function(e,t){for(var r in this.elements)if(this.elements[r].getId()===e)return this.elements[r].getVar(t)},Render.prototype.setFromCodeParts=function(e,t){var r=t.innerHTML,n=e.getVarsFromContent(r),o=e.getListsFromContent(r);for(var s in o)"undefined"!=typeof o[s]&&(r=this.getListContent(o[s]));t.innerHTML=r;for(var i in n)this.globalVars.hasVar(n[i])&&(r=r.replace("${"+n[i]+"}",this.globalVars.getVar(n[i])));t.innerHTML=r},Render.prototype.getListContent=function(e,t,r,n){var o=e.getVarsFromContent(t.content),s=[];for(var i in r.getVars())if(t.array===i)for(var a=this.getVar(r.getId(),t.array),l=t.content,f=t.var,p=0,c=o.length;c>p;p++)if(o[p].split(".")[0]==f)for(var u=0,h=a.length;h>u;u++){var d=o[p].split(".");d.splice(0,1);var m=a[u];for(var g in d)"undefined"!=typeof d[g]&&(m=m[d[g]]);s[u]="undefined"!=typeof s[u]?s[u].replace("${"+o[p]+"}",m):l.replace("${"+o[p]+"}",m)}return n.replace(t.complete,s.join(""))},Render.prototype.render=function(){for(var e in this.elements)if("undefined"!=typeof this.elements[e]){var t=this.elements[e],r=new ElementParser(t),n=r.getLists(t.getId()),o=document.getElementById(t.getId()),s=o.innerHTML;for(var i in n)"undefined"!=typeof n[i]&&(s=this.getListContent(r,n[i],t,s));var a=r.getVarsFromContent(s);for(var l in a)if("undefined"!=typeof a[l]){var f=a[l].split("."),p=f[0];f.splice(0,1);var c=t.getVar(p);if(t.hasVar(p)){if(f.length&&"object"==typeof t.getVar(p))for(var u in f)"undefined"!=typeof f[u]&&(c=c[f[u]]);s=s.replace("${"+a[l]+"}",c)}}o.innerHTML=s}var h=new Parser;this.setFromCodeParts(h,document.body),this.setFromCodeParts(h,document.head)},Render=new Render;